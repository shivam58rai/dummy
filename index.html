<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Asteroid Dodger</title>
    <style>
        :root{--bg:#0b1220;--panel:rgba(255,255,255,0.06);--accent:#64ffda}
        html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Arial;background:linear-gradient(180deg,#071021 0%,#0b1220 100%);color:#e6eef6}
        canvas{display:block;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);box-shadow:0 10px 40px rgba(2,6,23,0.6);margin:18px auto;border-radius:8px}
        .ui{position:fixed;left:18px;top:18px;padding:10px 14px;background:var(--panel);backdrop-filter:blur(6px);border-radius:8px}
        .ui .score{font-weight:700;color:var(--accent);font-size:18px}
        .center{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none}
        .panel{pointer-events:auto;background:rgba(2,6,23,0.75);padding:22px;border-radius:10px;text-align:center;min-width:300px}
        button{background:var(--accent);border:none;color:#012;padding:10px 14px;border-radius:8px;font-weight:700;cursor:pointer}
        .small{font-size:13px;color:#b8c6d6;margin-top:8px}
        .hint{font-size:13px;color:#9fb4ca;margin-top:6px}
        @media (max-width:600px){canvas{width:100%;height:70vh}}</style>
</head>
<body>
    <div class="ui">
        <div class="score">Score: <span id="score">0</span></div>
        <div class="small">High: <span id="high">0</span></div>
    </div>

    <div class="center">
        <div id="overlay" class="panel">
            <h2 id="title">Asteroid Dodger</h2>
            <p id="subtitle">Dodge asteroids for as long as possible. Move with arrow keys, WASD, mouse or touch.</p>
            <div style="margin-top:12px">
                <button id="startBtn">Start Game</button>
            </div>
            <div class="hint">Tap/click to move; use space to pause.</div>
        </div>
    </div>

    <canvas id="game"></canvas>

    <script>
        // Asteroid Dodger - single file game
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('score');
        const highEl = document.getElementById('high');
        const overlay = document.getElementById('overlay');
        const startBtn = document.getElementById('startBtn');

        // State
        let W = 800, H = 600;
        let last = 0, dt = 0;
        let gameState = 'menu'; // menu | playing | gameover | paused
        let player, asteroids, powerups, particles;
        let spawnTimer = 0, spawnInterval = 1.2; // seconds
        let score = 0, high = 0;
        let difficulty = 0.0; // increases with time

        const LS_KEY = 'asteroidDodgerHighscore_v1';
        high = Number(localStorage.getItem(LS_KEY) || 0);
        highEl.textContent = high;

        function resize(){
            const margin = 36;
            W = Math.max(360, Math.min(window.innerWidth - margin*2, 1100));
            H = Math.max(400, Math.min(window.innerHeight - margin*2, 900));
            canvas.width = W; canvas.height = H; canvas.style.width = W+'px'; canvas.style.height = H+'px';
        }
        window.addEventListener('resize', resize);

        // Utility
        function rand(a,b){return a + Math.random()*(b-a)}
        function clamp(v,a,b){return Math.max(a,Math.min(b,v))}
        function dist(a,b){return Math.hypot(a.x-b.x,a.y-b.y)}

        // Entities
        function createPlayer(){
            return {x:W/2,y:H*0.75,r:16,speed:380,vx:0,vy:0,shield:0,alive:true};
        }

        function spawnAsteroid(){
            // spawn from top or sides
            const edge = Math.random();
            let x,y,vx,vy;
            const size = Math.floor(rand(10,42));
            if(edge < 0.5){ // top
                x = rand(0,W); y = -size; vx = rand(-80,80); vy = rand(40,180);
            } else if(edge < 0.75){ // left
                x = -size; y = rand(0,H); vx = rand(60,240); vy = rand(-60,60);
            } else { // right
                x = W + size; y = rand(0,H); vx = rand(-240,-60); vy = rand(-60,60);
            }
            asteroids.push({x,y,vx,vy,r:size,rot:rand(0,Math.PI*2),spin:rand(-2,2)});
        }

        function spawnPowerup(){
            const t = Math.random() < 0.6 ? 'shield' : 'slow';
            powerups.push({x:rand(50,W-50),y:rand(50,H-200),r:12,type:t,duration:5});
        }

        function init(){
            resize();
            player = createPlayer();
            asteroids = [];
            powerups = [];
            particles = [];
            spawnTimer = 0; spawnInterval = 1.2; score = 0; difficulty = 0;
            last = performance.now();
        }

        // Input
        const keys = {};
        window.addEventListener('keydown', e=>{ keys[e.key.toLowerCase()] = true; if(e.key === ' '){ if(gameState==='playing'){ togglePause(); } } });
        window.addEventListener('keyup', e=>{ keys[e.key.toLowerCase()] = false; });

        // mouse control
        let pointer = {x:W/2,y:H/2,down:false};
        canvas.addEventListener('mousemove', e=>{ const rect = canvas.getBoundingClientRect(); pointer.x = (e.clientX-rect.left)*(canvas.width/rect.width); pointer.y = (e.clientY-rect.top)*(canvas.height/rect.height); });
        canvas.addEventListener('mousedown', e=>{ pointer.down = true; });
        canvas.addEventListener('mouseup', e=>{ pointer.down = false; });
        canvas.addEventListener('touchstart', e=>{ pointer.down = true; const t = e.touches[0]; const rect = canvas.getBoundingClientRect(); pointer.x = (t.clientX-rect.left)*(canvas.width/rect.width); pointer.y = (t.clientY-rect.top)*(canvas.height/rect.height); });
        canvas.addEventListener('touchmove', e=>{ const t = e.touches[0]; const rect = canvas.getBoundingClientRect(); pointer.x = (t.clientX-rect.left)*(canvas.width/rect.width); pointer.y = (t.clientY-rect.top)*(canvas.height/rect.height); });
        canvas.addEventListener('touchend', e=>{ pointer.down = false; });

        function togglePause(){
            if(gameState==='playing'){ gameState='paused'; overlay.style.display='flex'; document.getElementById('title').textContent='Paused'; document.getElementById('subtitle').textContent='Press Start to resume'; startBtn.textContent='Resume'; } else if(gameState==='paused'){ gameState='playing'; overlay.style.display='none'; }
        }

        // Game loop
        function update(ts){
            dt = Math.min((ts-last)/1000, 0.05); last = ts;
            if(gameState === 'playing'){
                difficulty += dt * 0.08;
                score += dt * 10; scoreEl.textContent = Math.floor(score);
                spawnTimer += dt;
                if(spawnTimer > spawnInterval){ spawnAsteroid(); spawnTimer = 0; spawnInterval = clamp(1.2 - difficulty*0.6, 0.35, 1.2); }
                // occasionally spawn powerup
                if(Math.random() < dt*0.06 + difficulty*0.002 && powerups.length < 2){ if(Math.random() < 0.15) spawnPowerup(); }

                // player movement - keyboard
                let ax=0, ay=0;
                if(keys['arrowleft']||keys['a']) ax -= 1;
                if(keys['arrowright']||keys['d']) ax += 1;
                if(keys['arrowup']||keys['w']) ay -= 1;
                if(keys['arrowdown']||keys['s']) ay += 1;
                // pointer movement (smooth follow)
                if(pointer.down){ const dx = pointer.x - player.x; const dy = pointer.y - player.y; player.vx = dx*3; player.vy = dy*3; }
                else { player.vx += ax * player.speed * dt * 6; player.vy += ay * player.speed * dt * 6; player.vx *= 0.88; player.vy *= 0.88; }

                // clamp
                player.x += player.vx * dt; player.y += player.vy * dt;
                player.x = clamp(player.x, player.r, W-player.r); player.y = clamp(player.y, player.r, H-player.r);

                // move asteroids
                for(let a of asteroids){ a.x += a.vx * dt; a.y += a.vy * dt; a.rot += a.spin * dt; }

                // collisions
                for(let i=asteroids.length-1;i>=0;i--){
                    const a = asteroids[i];
                    if(a.x < -100 || a.x > W+100 || a.y < -100 || a.y > H+100){ asteroids.splice(i,1); continue; }
                    const d = Math.hypot(a.x-player.x, a.y-player.y);
                    if(d < a.r + player.r){
                        if(player.shield > 0){ // absorb
                            player.shield = 0; createParticles(player.x,player.y,12,'#9be7ff'); asteroids.splice(i,1); }
                        else { // dead
                            player.alive = false; gameOver(); return; }
                    }
                }

                // powerups
                for(let i=powerups.length-1;i>=0;i--){ const p = powerups[i]; if(dist(p,player) < p.r + player.r){
                        if(p.type==='shield'){ player.shield = p.duration; }
                        else if(p.type==='slow'){ // slow all asteroids for a while
                            for(let a of asteroids){ a.vx *= 0.45; a.vy *= 0.45; }
                            setTimeout(()=>{ for(let a of asteroids){ a.vx *= 1.9; a.vy *= 1.9; } }, p.duration*1000);
                        }
                        createParticles(p.x,p.y,10,'#ffd27f'); powerups.splice(i,1);
                    }
                }

                // particles
                for(let i=particles.length-1;i>=0;i--){ const p = particles[i]; p.x += p.vx*dt; p.y += p.vy*dt; p.life -= dt; if(p.life<=0) particles.splice(i,1); }
            }
            render();
            requestAnimationFrame(update);
        }

        function createParticles(x,y,count,color){
            for(let i=0;i<count;i++){ particles.push({x:x+rand(-6,6),y:y+rand(-6,6),vx:rand(-120,120),vy:rand(-120,120),life:rand(0.3,1.2),col:color}); }
        }

        function render(){
            ctx.clearRect(0,0,W,H);
            // background stars
            ctx.fillStyle = '#071021'; ctx.fillRect(0,0,W,H);
            for(let i=0;i<60;i++){ const sx = (i*137.5)%W + Math.sin((i+Date.now()*0.0002))*6; ctx.fillStyle='rgba(255,255,255,0.03)'; ctx.fillRect(sx, (i*73.7)%H, 1,1); }

            // asteroids
            for(let a of asteroids){ ctx.save(); ctx.translate(a.x,a.y); ctx.rotate(a.rot); ctx.fillStyle='#9aa6b2'; ctx.beginPath(); ctx.ellipse(0,0,a.r,a.r*0.8,0,0,Math.PI*2); ctx.fill(); ctx.restore(); }

            // powerups
            for(let p of powerups){ ctx.beginPath(); ctx.fillStyle = p.type==='shield' ? '#9be7ff' : '#ffd27f'; ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill(); }

            // player
            if(player){
                ctx.beginPath(); ctx.fillStyle = player.shield>0 ? '#8ef' : '#64ffda'; ctx.arc(player.x,player.y,player.r,0,Math.PI*2); ctx.fill();
                if(player.shield>0){ ctx.strokeStyle='rgba(155,231,255,0.6)'; ctx.lineWidth=4; ctx.beginPath(); ctx.arc(player.x,player.y,player.r+6,0,Math.PI*2); ctx.stroke(); }
            }

            // particles
            for(let p of particles){ ctx.fillStyle = p.col; ctx.globalAlpha = Math.max(0, p.life); ctx.beginPath(); ctx.arc(p.x,p.y,3,0,Math.PI*2); ctx.fill(); ctx.globalAlpha = 1; }

            // HUD overlay handled by DOM
        }

        function gameOver(){
            gameState = 'gameover'; overlay.style.display='flex'; document.getElementById('title').textContent='Game Over'; document.getElementById('subtitle').textContent = 'Score: '+Math.floor(score);
            startBtn.textContent = 'Play Again';
            createParticles(player.x,player.y,30,'#ff8a8a');
            if(Math.floor(score) > high){ high = Math.floor(score); localStorage.setItem(LS_KEY, high); highEl.textContent = high; }
        }

        // Boot handlers
        startBtn.addEventListener('click', ()=>{
            if(gameState==='menu' || gameState==='gameover' || gameState==='paused'){
                init(); gameState = 'playing'; overlay.style.display='none';
            }
        });

        // initial setup
        init(); overlay.style.display = 'flex';
        // small auto-start cue if user presses space
        window.addEventListener('keydown', e=>{ if(e.key === ' ' && gameState!=='playing'){ init(); gameState='playing'; overlay.style.display='none'; } });

        // spawn initial asteroids gradually
        for(let i=0;i<4;i++) spawnAsteroid();

        requestAnimationFrame(update);
    </script>
</body>
</html>